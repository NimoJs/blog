<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="687px" preserveAspectRatio="none" style="width:755px;height:687px;" version="1.1" viewBox="0 0 755 687" width="755px" zoomAndPan="magnify"><defs><filter height="300%" id="fq4s04994d61a" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="72" x="339.5" y="28.708">缓存流程</text><rect fill="#FFFFFF" filter="url(#fq4s04994d61a)" height="434.8047" style="stroke:#000000;stroke-width:2.0;" width="731" x="10" y="192.6484"/><rect fill="#FFFFFF" filter="url(#fq4s04994d61a)" height="261.6016" style="stroke:#000000;stroke-width:2.0;" width="711" x="20" y="273.9141"/><rect fill="#FFFFFF" height="215.3359" style="stroke:none;stroke-width:1.0;" width="711" x="20" y="320.1797"/><rect fill="#FFFFFF" height="84.9375" style="stroke:none;stroke-width:1.0;" width="731" x="10" y="542.5156"/><line style="stroke:#A80036;stroke-width:1.0;" x1="64" x2="64" y1="75.25" y2="238.9141"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="64" x2="64" y1="238.9141" y2="266.9141"/><line style="stroke:#A80036;stroke-width:1.0;" x1="64" x2="64" y1="266.9141" y2="334.9844"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="64" x2="64" y1="334.9844" y2="362.9844"/><line style="stroke:#A80036;stroke-width:1.0;" x1="64" x2="64" y1="362.9844" y2="392.1172"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="64" x2="64" y1="392.1172" y2="420.1172"/><line style="stroke:#A80036;stroke-width:1.0;" x1="64" x2="64" y1="420.1172" y2="449.25"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="64" x2="64" y1="449.25" y2="477.25"/><line style="stroke:#A80036;stroke-width:1.0;" x1="64" x2="64" y1="477.25" y2="557.3203"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="64" x2="64" y1="557.3203" y2="585.3203"/><line style="stroke:#A80036;stroke-width:1.0;" x1="64" x2="64" y1="585.3203" y2="644.4531"/><line style="stroke:#A80036;stroke-width:1.0;" x1="246.5" x2="246.5" y1="75.25" y2="238.9141"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="246.5" x2="246.5" y1="238.9141" y2="266.9141"/><line style="stroke:#A80036;stroke-width:1.0;" x1="246.5" x2="246.5" y1="266.9141" y2="334.9844"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="246.5" x2="246.5" y1="334.9844" y2="362.9844"/><line style="stroke:#A80036;stroke-width:1.0;" x1="246.5" x2="246.5" y1="362.9844" y2="392.1172"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="246.5" x2="246.5" y1="392.1172" y2="420.1172"/><line style="stroke:#A80036;stroke-width:1.0;" x1="246.5" x2="246.5" y1="420.1172" y2="449.25"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="246.5" x2="246.5" y1="449.25" y2="477.25"/><line style="stroke:#A80036;stroke-width:1.0;" x1="246.5" x2="246.5" y1="477.25" y2="557.3203"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="246.5" x2="246.5" y1="557.3203" y2="585.3203"/><line style="stroke:#A80036;stroke-width:1.0;" x1="246.5" x2="246.5" y1="585.3203" y2="644.4531"/><line style="stroke:#A80036;stroke-width:1.0;" x1="525" x2="525" y1="75.25" y2="238.9141"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="525" x2="525" y1="238.9141" y2="266.9141"/><line style="stroke:#A80036;stroke-width:1.0;" x1="525" x2="525" y1="266.9141" y2="334.9844"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="525" x2="525" y1="334.9844" y2="362.9844"/><line style="stroke:#A80036;stroke-width:1.0;" x1="525" x2="525" y1="362.9844" y2="392.1172"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="525" x2="525" y1="392.1172" y2="420.1172"/><line style="stroke:#A80036;stroke-width:1.0;" x1="525" x2="525" y1="420.1172" y2="449.25"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="525" x2="525" y1="449.25" y2="477.25"/><line style="stroke:#A80036;stroke-width:1.0;" x1="525" x2="525" y1="477.25" y2="557.3203"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="525" x2="525" y1="557.3203" y2="585.3203"/><line style="stroke:#A80036;stroke-width:1.0;" x1="525" x2="525" y1="585.3203" y2="644.4531"/><line style="stroke:#A80036;stroke-width:1.0;" x1="597" x2="597" y1="75.25" y2="238.9141"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="597" x2="597" y1="238.9141" y2="266.9141"/><line style="stroke:#A80036;stroke-width:1.0;" x1="597" x2="597" y1="266.9141" y2="334.9844"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="597" x2="597" y1="334.9844" y2="362.9844"/><line style="stroke:#A80036;stroke-width:1.0;" x1="597" x2="597" y1="362.9844" y2="392.1172"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="597" x2="597" y1="392.1172" y2="420.1172"/><line style="stroke:#A80036;stroke-width:1.0;" x1="597" x2="597" y1="420.1172" y2="449.25"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="597" x2="597" y1="449.25" y2="477.25"/><line style="stroke:#A80036;stroke-width:1.0;" x1="597" x2="597" y1="477.25" y2="557.3203"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="597" x2="597" y1="557.3203" y2="585.3203"/><line style="stroke:#A80036;stroke-width:1.0;" x1="597" x2="597" y1="585.3203" y2="644.4531"/><line style="stroke:#A80036;stroke-width:1.0;" x1="679" x2="679" y1="75.25" y2="238.9141"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="679" x2="679" y1="238.9141" y2="266.9141"/><line style="stroke:#A80036;stroke-width:1.0;" x1="679" x2="679" y1="266.9141" y2="334.9844"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="679" x2="679" y1="334.9844" y2="362.9844"/><line style="stroke:#A80036;stroke-width:1.0;" x1="679" x2="679" y1="362.9844" y2="392.1172"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="679" x2="679" y1="392.1172" y2="420.1172"/><line style="stroke:#A80036;stroke-width:1.0;" x1="679" x2="679" y1="420.1172" y2="449.25"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="679" x2="679" y1="449.25" y2="477.25"/><line style="stroke:#A80036;stroke-width:1.0;" x1="679" x2="679" y1="477.25" y2="557.3203"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="679" x2="679" y1="557.3203" y2="585.3203"/><line style="stroke:#A80036;stroke-width:1.0;" x1="679" x2="679" y1="585.3203" y2="644.4531"/><rect fill="#FEFECE" filter="url(#fq4s04994d61a)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="64" x="30" y="39.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="50" x="37" y="59.9482">client1</text><rect fill="#FEFECE" filter="url(#fq4s04994d61a)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="64" x="30" y="643.4531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="50" x="37" y="663.4482">client1</text><rect fill="#FEFECE" filter="url(#fq4s04994d61a)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="59" x="215.5" y="39.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45" x="222.5" y="59.9482">server</text><rect fill="#FEFECE" filter="url(#fq4s04994d61a)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="59" x="215.5" y="643.4531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45" x="222.5" y="663.4482">server</text><rect fill="#FEFECE" filter="url(#fq4s04994d61a)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="60" x="493" y="39.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="46" x="500" y="59.9482">mutex</text><rect fill="#FEFECE" filter="url(#fq4s04994d61a)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="60" x="493" y="643.4531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="46" x="500" y="663.4482">mutex</text><rect fill="#FEFECE" filter="url(#fq4s04994d61a)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="56" x="567" y="39.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42" x="574" y="59.9482">cache</text><rect fill="#FEFECE" filter="url(#fq4s04994d61a)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="56" x="567" y="643.4531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42" x="574" y="663.4482">cache</text><rect fill="#FEFECE" filter="url(#fq4s04994d61a)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="80" x="637" y="39.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="644" y="59.9482">database</text><rect fill="#FEFECE" filter="url(#fq4s04994d61a)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="80" x="637" y="643.4531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="644" y="663.4482">database</text><polygon fill="#A80036" points="235,102.3828,245,106.3828,235,110.3828,239,106.3828" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="64" x2="241" y1="106.3828" y2="106.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="71" y="101.3169">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="146" x="84" y="101.3169">QuestionByID(id, retry)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="247" x2="289" y1="135.5156" y2="135.5156"/><line style="stroke:#A80036;stroke-width:1.0;" x1="289" x2="289" y1="135.5156" y2="148.5156"/><line style="stroke:#A80036;stroke-width:1.0;" x1="248" x2="289" y1="148.5156" y2="148.5156"/><polygon fill="#A80036" points="258,144.5156,248,148.5156,258,152.5156,254,148.5156" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="254" y="130.4497">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156" x="267" y="130.4497">判断 retry 次数防止死循环</text><polygon fill="#A80036" points="513,173.6484,523,177.6484,513,181.6484,517,177.6484" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="247" x2="519" y1="177.6484" y2="177.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8" x="254" y="172.5825">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="266" y="172.5825">尝试上锁</text><path d="M10,192.6484 L76,192.6484 L76,199.6484 L66,209.6484 L10,209.6484 L10,192.6484 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="434.8047" style="stroke:#000000;stroke-width:2.0;" width="731" x="10" y="192.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="25" y="205.7153">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="54" x="91" y="204.8589">[上锁成功]</text><polygon fill="#A80036" points="585,226.9141,595,230.9141,585,234.9141,589,230.9141" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="247" x2="591" y1="230.9141" y2="230.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="254" y="225.8481">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="267" y="225.8481">查询缓存</text><path d="M20,273.9141 L86,273.9141 L86,280.9141 L76,290.9141 L20,290.9141 L20,273.9141 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="261.6016" style="stroke:#000000;stroke-width:2.0;" width="711" x="20" y="273.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="35" y="286.981">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="54" x="101" y="286.1245">[缓存存在]</text><polygon fill="#A80036" points="75,308.1797,65,312.1797,75,316.1797,71,312.1797" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="69" x2="246" y1="312.1797" y2="312.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="81" y="307.1138">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="94" y="307.1138">返回缓存数据</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="20" x2="731" y1="321.1797" y2="321.1797"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="65" x="25" y="331.3901">[缓存不存在]</text><polygon fill="#A80036" points="667,380.1172,677,384.1172,667,388.1172,671,384.1172" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="247" x2="673" y1="384.1172" y2="384.1172"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="254" y="379.0513">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="267" y="379.0513">查询数据库</text><polygon fill="#A80036" points="258,437.25,248,441.25,258,445.25,254,441.25" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="252" x2="678" y1="441.25" y2="441.25"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="264" y="436.1841">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="277" y="436.1841">返回数据</text><polygon fill="#A80036" points="585,494.3828,595,498.3828,585,502.3828,589,498.3828" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="247" x2="591" y1="498.3828" y2="498.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="254" y="493.3169">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="267" y="493.3169">更新缓存</text><polygon fill="#A80036" points="75,523.5156,65,527.5156,75,531.5156,71,527.5156" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="69" x2="246" y1="527.5156" y2="527.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="81" y="522.4497">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="94" y="522.4497">返回数据</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="741" y1="543.5156" y2="543.5156"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="54" x="15" y="553.7261">[上锁失败]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="247" x2="289" y1="606.4531" y2="606.4531"/><line style="stroke:#A80036;stroke-width:1.0;" x1="289" x2="289" y1="606.4531" y2="619.4531"/><line style="stroke:#A80036;stroke-width:1.0;" x1="248" x2="289" y1="619.4531" y2="619.4531"/><polygon fill="#A80036" points="258,615.4531,248,619.4531,258,623.4531,254,619.4531" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="254" y="601.3872">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="241" x="277" y="601.3872">延迟一秒后重试 QuestionByID(id, retry)</text><!--MD5=[40b9e68277a30229674a5f1c18194e69]
@startuml
autonumber
title: 缓存流程
client1->server: QuestionByID(id, retry)
server->server: 判断 retry 次数防止死循环
server->mutex: 尝试上锁
alt 上锁成功
    server->cache: 查询缓存
    ...
    alt 缓存存在
        server->client1: 返回缓存数据
    else 缓存不存在
        ...
        server- ->database: 查询数据库
        ...
        database->server: 返回数据
        ...
        server->cache: 更新缓存
        server->client1: 返回数据
    end
else 上锁失败
    ...
    server->server: 延迟一秒后重试 QuestionByID(id, retry)
end
@enduml

PlantUML version 1.2021.2beta9(Unknown compile time)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>