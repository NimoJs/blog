<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="659px" preserveAspectRatio="none" style="width:757px;height:659px;" version="1.1" viewBox="0 0 757 659" width="757px" zoomAndPan="magnify"><defs><filter height="300%" id="f1cf2jkulal3i5" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="72" x="340.5" y="28.708">缓存流程</text><rect fill="#FFFFFF" filter="url(#f1cf2jkulal3i5)" height="378.8047" style="stroke:#000000;stroke-width:2.0;" width="733" x="10" y="220.6484"/><rect fill="#FFFFFF" height="332.5391" style="stroke:none;stroke-width:1.0;" width="733" x="10" y="266.9141"/><rect fill="#FFFFFF" filter="url(#f1cf2jkulal3i5)" height="274.6016" style="stroke:#000000;stroke-width:2.0;" width="713" x="20" y="317.8516"/><rect fill="#FFFFFF" height="84.9375" style="stroke:none;stroke-width:1.0;" width="713" x="20" y="507.5156"/><line style="stroke:#A80036;stroke-width:1.0;" x1="64" x2="64" y1="75.25" y2="185.6484"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="64" x2="64" y1="185.6484" y2="213.6484"/><line style="stroke:#A80036;stroke-width:1.0;" x1="64" x2="64" y1="213.6484" y2="364.1172"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="64" x2="64" y1="364.1172" y2="392.1172"/><line style="stroke:#A80036;stroke-width:1.0;" x1="64" x2="64" y1="392.1172" y2="421.25"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="64" x2="64" y1="421.25" y2="449.25"/><line style="stroke:#A80036;stroke-width:1.0;" x1="64" x2="64" y1="449.25" y2="522.3203"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="64" x2="64" y1="522.3203" y2="550.3203"/><line style="stroke:#A80036;stroke-width:1.0;" x1="64" x2="64" y1="550.3203" y2="616.4531"/><line style="stroke:#A80036;stroke-width:1.0;" x1="246.5" x2="246.5" y1="75.25" y2="185.6484"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="246.5" x2="246.5" y1="185.6484" y2="213.6484"/><line style="stroke:#A80036;stroke-width:1.0;" x1="246.5" x2="246.5" y1="213.6484" y2="364.1172"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="246.5" x2="246.5" y1="364.1172" y2="392.1172"/><line style="stroke:#A80036;stroke-width:1.0;" x1="246.5" x2="246.5" y1="392.1172" y2="421.25"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="246.5" x2="246.5" y1="421.25" y2="449.25"/><line style="stroke:#A80036;stroke-width:1.0;" x1="246.5" x2="246.5" y1="449.25" y2="522.3203"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="246.5" x2="246.5" y1="522.3203" y2="550.3203"/><line style="stroke:#A80036;stroke-width:1.0;" x1="246.5" x2="246.5" y1="550.3203" y2="616.4531"/><line style="stroke:#A80036;stroke-width:1.0;" x1="525" x2="525" y1="75.25" y2="185.6484"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="525" x2="525" y1="185.6484" y2="213.6484"/><line style="stroke:#A80036;stroke-width:1.0;" x1="525" x2="525" y1="213.6484" y2="364.1172"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="525" x2="525" y1="364.1172" y2="392.1172"/><line style="stroke:#A80036;stroke-width:1.0;" x1="525" x2="525" y1="392.1172" y2="421.25"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="525" x2="525" y1="421.25" y2="449.25"/><line style="stroke:#A80036;stroke-width:1.0;" x1="525" x2="525" y1="449.25" y2="522.3203"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="525" x2="525" y1="522.3203" y2="550.3203"/><line style="stroke:#A80036;stroke-width:1.0;" x1="525" x2="525" y1="550.3203" y2="616.4531"/><line style="stroke:#A80036;stroke-width:1.0;" x1="597" x2="597" y1="75.25" y2="185.6484"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="597" x2="597" y1="185.6484" y2="213.6484"/><line style="stroke:#A80036;stroke-width:1.0;" x1="597" x2="597" y1="213.6484" y2="364.1172"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="597" x2="597" y1="364.1172" y2="392.1172"/><line style="stroke:#A80036;stroke-width:1.0;" x1="597" x2="597" y1="392.1172" y2="421.25"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="597" x2="597" y1="421.25" y2="449.25"/><line style="stroke:#A80036;stroke-width:1.0;" x1="597" x2="597" y1="449.25" y2="522.3203"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="597" x2="597" y1="522.3203" y2="550.3203"/><line style="stroke:#A80036;stroke-width:1.0;" x1="597" x2="597" y1="550.3203" y2="616.4531"/><line style="stroke:#A80036;stroke-width:1.0;" x1="681" x2="681" y1="75.25" y2="185.6484"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="681" x2="681" y1="185.6484" y2="213.6484"/><line style="stroke:#A80036;stroke-width:1.0;" x1="681" x2="681" y1="213.6484" y2="364.1172"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="681" x2="681" y1="364.1172" y2="392.1172"/><line style="stroke:#A80036;stroke-width:1.0;" x1="681" x2="681" y1="392.1172" y2="421.25"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="681" x2="681" y1="421.25" y2="449.25"/><line style="stroke:#A80036;stroke-width:1.0;" x1="681" x2="681" y1="449.25" y2="522.3203"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="681" x2="681" y1="522.3203" y2="550.3203"/><line style="stroke:#A80036;stroke-width:1.0;" x1="681" x2="681" y1="550.3203" y2="616.4531"/><rect fill="#FEFECE" filter="url(#f1cf2jkulal3i5)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="64" x="30" y="39.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="50" x="37" y="59.9482">client1</text><rect fill="#FEFECE" filter="url(#f1cf2jkulal3i5)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="64" x="30" y="615.4531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="50" x="37" y="635.4482">client1</text><rect fill="#FEFECE" filter="url(#f1cf2jkulal3i5)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="59" x="215.5" y="39.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45" x="222.5" y="59.9482">server</text><rect fill="#FEFECE" filter="url(#f1cf2jkulal3i5)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="59" x="215.5" y="615.4531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45" x="222.5" y="635.4482">server</text><rect fill="#FEFECE" filter="url(#f1cf2jkulal3i5)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="56" x="495" y="39.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42" x="502" y="59.9482">cache</text><rect fill="#FEFECE" filter="url(#f1cf2jkulal3i5)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="56" x="495" y="615.4531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42" x="502" y="635.4482">cache</text><rect fill="#FEFECE" filter="url(#f1cf2jkulal3i5)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="60" x="565" y="39.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="46" x="572" y="59.9482">mutex</text><rect fill="#FEFECE" filter="url(#f1cf2jkulal3i5)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="60" x="565" y="615.4531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="46" x="572" y="635.4482">mutex</text><rect fill="#FEFECE" filter="url(#f1cf2jkulal3i5)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="80" x="639" y="39.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="646" y="59.9482">database</text><rect fill="#FEFECE" filter="url(#f1cf2jkulal3i5)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="80" x="639" y="615.4531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="646" y="635.4482">database</text><polygon fill="#A80036" points="235,102.3828,245,106.3828,235,110.3828,239,106.3828" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="64" x2="241" y1="106.3828" y2="106.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="71" y="101.3169">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="146" x="84" y="101.3169">QuestionByID(id, retry)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="247" x2="289" y1="135.5156" y2="135.5156"/><line style="stroke:#A80036;stroke-width:1.0;" x1="289" x2="289" y1="135.5156" y2="148.5156"/><line style="stroke:#A80036;stroke-width:1.0;" x1="248" x2="289" y1="148.5156" y2="148.5156"/><polygon fill="#A80036" points="258,144.5156,248,148.5156,258,152.5156,254,148.5156" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="254" y="130.4497">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156" x="267" y="130.4497">判断 retry 次数防止死循环</text><polygon fill="#A80036" points="513,173.6484,523,177.6484,513,181.6484,517,177.6484" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="247" x2="519" y1="177.6484" y2="177.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8" x="254" y="172.5825">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="266" y="172.5825">查询缓存</text><path d="M10,220.6484 L76,220.6484 L76,227.6484 L66,237.6484 L10,237.6484 L10,220.6484 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="378.8047" style="stroke:#000000;stroke-width:2.0;" width="733" x="10" y="220.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="25" y="233.7153">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="54" x="91" y="232.8589">[缓存存在]</text><polygon fill="#A80036" points="75,254.9141,65,258.9141,75,262.9141,71,258.9141" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="69" x2="246" y1="258.9141" y2="258.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="81" y="253.8481">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="94" y="253.8481">返回缓存数据</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="743" y1="267.9141" y2="267.9141"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="65" x="15" y="278.1245">[缓存不存在]</text><polygon fill="#A80036" points="585,298.8516,595,302.8516,585,306.8516,589,302.8516" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="247" x2="591" y1="302.8516" y2="302.8516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="254" y="297.7856">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="267" y="297.7856">尝试上锁</text><path d="M20,317.8516 L86,317.8516 L86,324.8516 L76,334.8516 L20,334.8516 L20,317.8516 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="274.6016" style="stroke:#000000;stroke-width:2.0;" width="713" x="20" y="317.8516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="35" y="330.9185">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="54" x="101" y="330.062">[上锁成功]</text><polygon fill="#A80036" points="669,352.1172,679,356.1172,669,360.1172,673,356.1172" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="247" x2="675" y1="356.1172" y2="356.1172"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="254" y="351.0513">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="267" y="351.0513">查询数据库</text><polygon fill="#A80036" points="258,409.25,248,413.25,258,417.25,254,413.25" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="252" x2="680" y1="413.25" y2="413.25"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="264" y="408.1841">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="277" y="408.1841">返回数据</text><polygon fill="#A80036" points="513,466.3828,523,470.3828,513,474.3828,517,470.3828" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="247" x2="519" y1="470.3828" y2="470.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="254" y="465.3169">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="267" y="465.3169">更新缓存</text><polygon fill="#A80036" points="75,495.5156,65,499.5156,75,503.5156,71,499.5156" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="69" x2="246" y1="499.5156" y2="499.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="81" y="494.4497">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="94" y="494.4497">返回数据</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="20" x2="733" y1="508.5156" y2="508.5156"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="54" x="25" y="518.7261">[上锁失败]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="247" x2="289" y1="571.4531" y2="571.4531"/><line style="stroke:#A80036;stroke-width:1.0;" x1="289" x2="289" y1="571.4531" y2="584.4531"/><line style="stroke:#A80036;stroke-width:1.0;" x1="248" x2="289" y1="584.4531" y2="584.4531"/><polygon fill="#A80036" points="258,580.4531,248,584.4531,258,588.4531,254,584.4531" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="254" y="566.3872">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="241" x="277" y="566.3872">延迟一秒后重试 QuestionByID(id, retry)</text><!--MD5=[bbdae3f9aeec7db685618096d6ff2941]
@startuml
autonumber
title: 缓存流程
client1->server: QuestionByID(id, retry)
server->server: 判断 retry 次数防止死循环
server->cache: 查询缓存
...
alt 缓存存在
  server->client1: 返回缓存数据
else 缓存不存在
  server->mutex: 尝试上锁
  alt 上锁成功
    server- ->database: 查询数据库
    ...
    database->server: 返回数据
    ...
    server->cache: 更新缓存
    server->client1: 返回数据
  else 上锁失败
      ...
      server->server: 延迟一秒后重试 QuestionByID(id, retry)
  end
end
@enduml

PlantUML version 1.2021.2beta9(Unknown compile time)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>
